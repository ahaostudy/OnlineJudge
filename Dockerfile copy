FROM golang:1.20.7-alpine3.17

ENV GOPROXY https://goproxy.cn
ENV s gateway

VOLUME ["/data"]

RUN apt-get update && apt-get install -y g++-11 && rm -rf /var/lib/apt/lists/*

WORKDIR $GOPATH/src/OnlineJudge

COPY . .

RUN go build -o j cmd/judge/main.go
RUN go build -o p cmd/problem/main.go
RUN go build -o s cmd/submit/main.go
RUN go build -o u cmd/user/main.go
RUN go build -o c cmd/chatgpt/main.go
RUN go build -o g cmd/gateway/main.go

EXPOSE 8080 9991 9992 9993 9994 9995 9996

CMD [ "rm", "-rf", "cache" ]
ENTRYPOINT ./$s
